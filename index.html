<html>
<meta charset="utf-8"/>
<head>
	<title>Richard Quan (NetID: rq32)</title>
	<link href='https://fonts.googleapis.com/css?family=Raleway:100' rel='stylesheet' type='text/css'>
	<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
	<script src="http://d3js.org/topojson.v1.min.js"></script>
	<script type="text/javascript" src="hashset.js"></script>
	<script type="text/javascript" src="hashtable.js"></script>
	<style>
	body { font-family: Lucida Grande, sans-serif; background-color: rgb(39,40,34); color: white; } div { margin: 30px; }
	h1 {font-family: 'Lucida Grande', 'Lucida Sans Unicode', 'Lucida Sans', Geneva, Verdana, sans-serif;
	font-size: 24px;
	font-style: normal;
	font-variant: normal;
	font-weight: 200;
	line-height: 28.4px; color: white;
	text-align: center;}
	h3 { font-family: 'Lucida Grande', 'Lucida Sans Unicode', 'Lucida Sans', Geneva, Verdana, sans-serif;
	font-size: 20px;
	font-style: normal;
	font-variant: normal;
	font-weight: 100;
	line-height: 28.4px; color: white;
	text-align: center;}
	svg { border: none; fill: none;}
	.axis path { fill: none; stroke:  #f8f8ff; stroke-opacity: 1;}
	.axis line { stroke:  #f8f8ff; stroke-opacity: 1;}
	.axis text { font-size: 0.5em; fill: #f8f8ff; opacity: 1;}
	.noTextAxis text { font-size: 0em; }  
	.logAxis text { font-size: 0.3em; } 
	text {fill-opacity : 1;}
	circle {fill-opacity : 0.8;}
	line {opacity : 1;}

	.statesinline {font-family: 'Raleway', sans-serif;}
}
	
	</style>
</head>
<body>
	<h3>CS/INFO 3300 / INFO 5100</h3>
	<h3>Project 1</h3>
	<h3>Richard Quan (rq32), Akshay Tata(at758), YuanYuan Li(yl2577)</h3>
	<h1>Average Cost per Hospital for Top 12 Most Common Diagnoses in the United States</h1>
	<br>
	<br>
	<p id="p2output" align = "center">
	<script>

		var svg2a = d3.select("#p2output").append("svg");
		svg2a.attr("height",500).attr("width",1200);


		svg2a.append("rect")
		.attr("height","1000")
		.attr("width", "1000")
		.style("fill", "none");
		
		var topPad = 10;
		var botPad = 30;
		var leftPad = 40;
		var rightPad = 10;
		var height = svg2a.attr("height")-topPad-botPad;
		var width = svg2a.attr("width")-leftPad-rightPad;
		var xScale = d3.scale.linear().domain([10000,60000]).range([0, width]);
		var yScale = d3.scale.linear().domain([10000,40000]).range([height, 0]);
	
		var radScale = d3.scale.linear().domain([18250, 58000]).range([20, 35]);
		var opacityScale = d3.scale.linear().domain([9000, 150000]).range([0.2, 1]);


		var top12Diag =	["470 - MAJOR JOINT REPLACEMENT OR REATTACHMENT OF LOWER EXTREMITY W/O MCC",
		"871 - SEPTICEMIA OR SEVERE SEPSIS W/O MV 96+ HOURS W MCC",
		"392 - ESOPHAGITIS, GASTROENT & MISC DIGEST DISORDERS W/O MCC",
		"292 - HEART FAILURE & SHOCK W CC",
		"690 - KIDNEY & URINARY TRACT INFECTIONS W/O MCC",
		"291 - HEART FAILURE & SHOCK W MCC",
		"194 - SIMPLE PNEUMONIA & PLEURISY W CC",
		"683 - RENAL FAILURE W CC",
		"190 - CHRONIC OBSTRUCTIVE PULMONARY DISEASE W MCC",
		"603 - CELLULITIS W/O MCC",
		"378 - G.I. HEMORRHAGE W CC",
		"191 - CHRONIC OBSTRUCTIVE PULMONARY DISEASE W CC"];

		var top12DiagHashSet = new HashSet();

		for(var i = 0; i < 12; i++)
		{
			top12DiagHashSet.add(top12Diag[i]);	
		}



		/*var xAxis = d3.svg.axis().scale(xScale).orient("bottom").tickFormat(d3.format("s"));
		svg2a.append("g").attr("class", "axis")
		.attr("transform", "translate("+leftPad+","+(height+topPad)+")")
		.call(xAxis);*/

		var yAxis = d3.svg.axis().scale(yScale).orient("left").tickFormat(d3.format("s"));
		svg2a.append("g").attr("class", "axis")
		.attr("transform", "translate("+leftPad+","+topPad+")")
		.call(yAxis);

		var yearCnt = 0;
		var yearCntGreen = 0;
		var ctrVar = 0;

		var xArr = [xScale(52062.94) - 690, xScale(59444.46) - 590, xScale(66698.56) - 490];

		var hashObj = {};

		var countNum = [-80, -40, 0, -10, -120, 20, -160, -130, -60, -100, -140, -70];

		var dischargeText = "\"Total No. of discharges billed\"";

		var avgtotText = "\"Avg. Medicare Paym. to the Provider\"";

		var avgCharge = "\"Avg. charge, provider billed to Medicare\"";

		svg2a.append("line")
			.attr("stroke", "white")
			.attr("stroke-width", "1")
			.attr("x1", xArr[1] - 300)
			.attr("y1", topPad)
			.attr("x2", xArr[1] - 300)
			.attr("opacity", "0.5")
			.attr("y2", 1000 - topPad - botPad);

		svg2a.append("line")
			.attr("stroke", "white")
			.attr("stroke-width", "1")
			.attr("x1", xArr[2] - 330)
			.attr("y1", topPad)
			.attr("opacity", "0.5")
			.attr("x2", xArr[2] - 330)
			.attr("y2", 1000 - topPad - botPad);


		svg2a.append("line")
			.attr("stroke", "white")
			.attr("stroke-width", "1")
			.attr("x1", xArr[2] - 80)
			.attr("y1", topPad)
			.attr("opacity", "0.5")
			.attr("x2", xArr[2] - 80)
			.attr("y2", 1000 - topPad - botPad);
		
		svg2a.append("text")
			.text("2011")
			.attr("font-size",15)
			.attr("text-anchor","middle")
			.attr("alignment-baseline","middle")
			.attr("fill","#f8f8ff")
			.attr("x", 120)//x
			.attr("y", 500 - 10);//y

		svg2a.append("text")
			.text("2012")
			.attr("font-size",15)
			.attr("text-anchor","middle")
			.attr("alignment-baseline","middle")
			.attr("fill","#f8f8ff")
			.attr("x", 360)//x
			.attr("y", 500 - 10);//y

		svg2a.append("text")
			.text("2013")
			.attr("font-size",15)
			.attr("text-anchor","middle")
			.attr("alignment-baseline","middle")
			.attr("fill","#f8f8ff")
			.attr("x", 600)//x
			.attr("y", 500 - 10);//y

		svg2a.append("text")
			.text("Key")
			.attr("font-size",15)
			.attr("text-anchor","middle")
			.attr("alignment-baseline","middle")
			.attr("fill","#f8f8ff")
			.attr("x", 960)//x
			.attr("y", 500 - 10);//y
		
		var totWordCtr = 10;
		//var ctr = 150
		var drgData;
		var drg2011;
		var drg2012;
		var drg2013;
		var keyCtr = 20;
		d3.json("medicaldata.json", function(error, json) {
  			if (error) return console.warn(error);
  			drgData = json;

  			//Sorting drgData based on year 2011
  			drg2011 = drgData.sort(function(a, b) {
  				 return parseFloat(a.year2011) - parseFloat(b.year2011);
			});

  			//Sorting drgData based on year 2012
  			drg2012 = drgData.sort(function(a, b) {
  				 return parseFloat(a.year2012) - parseFloat(b.year2012);
			});

			//Sorting drgData based on year 2012
  			drg2013 = drgData.sort(function(a, b) {
  				 return parseFloat(a.year2013) - parseFloat(b.year2013);
			});
		
		drg2011.forEach(function (drg) {

				if(top12DiagHashSet.contains(drg.nameDRG))
				{
				svg2a.append("circle")
				.attr("cx", xArr[0]+leftPad + countNum[(Math.floor(Math.random() * (12)) + 1) - 1] - 105)
				.attr("cy", yScale(drg.year2011)+topPad)
				.attr("r", 9)
				.attr("fill", drg.color)
				.attr("fill-opacity", 1);

				svg2a.append("circle")
				.attr("cx", 750)
				.attr("cy", keyCtr)
				.attr("r", 9)
				.attr("fill", drg.color)
				.attr("fill-opacity", 1);

				svg2a.append("text")
				.attr("x", 770)
				.attr("y", keyCtr + 4)
				.text(drg.nameDRG)
				.attr("font-size",10)
				.attr("fill", "white")
				.attr("fill-opacity", 1);

				keyCtr = keyCtr + 40;
			   }
		});

		drg2012.forEach(function (drg) {	

					if(top12DiagHashSet.contains(drg.nameDRG))
				{
				svg2a.append("circle")
				.attr("cx", xArr[1]+leftPad + countNum[(Math.floor(Math.random() * (12)) + 1) - 1] - 150)
				.attr("cy", yScale(drg.year2012)+topPad)
				.attr("r", 9)
				.attr("fill", drg.color)
				.attr("fill-opacity", 1);
				}
		});

		drg2013.forEach(function (drg) {	

				if(top12DiagHashSet.contains(drg.nameDRG))
				{
				svg2a.append("circle")
				.attr("cx", xArr[2]+leftPad+countNum[(Math.floor(Math.random() * (12)) + 1) - 1] - 190)
				.attr("cy", yScale(drg.year2013)+topPad)
				.attr("r", 9)
				.attr("fill", drg.color)
				.attr("fill-opacity", 1);
				}
		});	
		
});

	</script>
</p>
<br>

	<p>
	<h1>Major Joint Replacement or Reattachment of Lower Extremity w/o MCC - Major complication</h1>

	<h3> Percentage Change in hospital costs from 2011 - 2013 </h3>

	<div id="state" align = "center"></div>
	<script type="text/javascript">
	var width = 960, height = 500;

	var svg = d3.select("#state").append("svg")
				.attr("height", height).attr("width", width);

	var projection = d3.geo.albersUsa();
	var path = d3.geo.path().projection(projection);
	var states;
	var inpatient;
	var stateChangeDic = {} //This is a state change Dictionary
	var statePath = svg.append("g");
	var digitScale = d3.scale.category20();
	var gapScale = d3.scale.linear().domain([0, 51000]).range(["#008000", "#FF0000"]);

	var changeScale = d3.scale.linear().domain([-8,0, 24.50]).range(["#0080ff", "#ffffff","#FF0000"]);

	var alldata = [];

	d3.json("us.json", function(error, shapes) {
	states = topojson.feature(shapes, shapes.objects.states).features;
	statePath.selectAll("path").data(states).enter()
	.append("path")
	.attr("d", path)
	.style("fill", function (states) { return changeScale(stateChangeDic[states.id]); })
	.attr("opacity","0.8")
	.style("stroke", "none")
	.style("stroke-width", "1");
	});

		var rowsExcel;

		d3.csv("inpatient.csv", function (error, rows) {
		if (error) {console.log(error);}

		rowsExcel = rows;

		rowsExcel.forEach(function(stateRow)
		{
			stateChangeDic[stateRow.id] = stateRow.Change;
		});
	 
		});
	 	
	var gradient2 = svg.append("defs")
  			.append("linearGradient")
		    .attr("id", "gradient")
		    .attr("x1", "0%")
		    .attr("y1", "0%")
		    .attr("x2", "100%")
		    .attr("y2", "0%")
		    .attr("spreadMethod", "pad");

			gradient2.append("stop")
			    .attr("offset", "0%")
			    .attr("stop-color", "#0080ff")
			    .attr("stop-opacity", 1);

			gradient2.append("stop")
			    .attr("offset", "100%")
			    .attr("stop-color", "#FF0000")
			    .attr("stop-opacity", 1);


			svg.append("rect")
			 	.attr("x",800)
			 	.attr("y",400)
			 	.attr("width",100)
			 	.attr("height",10)
			 	.style("fill","url(#gradient)")
			 	.style("stroke","none")	;

			 	svg.append("text")
	 			.attr("x",920)
	 			.attr("y",405)
	 			.text("+25.9%")
	 			.attr("font-size",10)
				.attr("text-anchor","middle")
				.attr("fill","white")
				.attr("alignment-baseline","middle");

				svg.append("text")
	 			.attr("x",785)
	 			.attr("y",405)
	 			.attr("fill","white")
	 			.text("-7%")
	 			.attr("font-size",10)
				.attr("text-anchor","middle")
				.attr("alignment-baseline","middle");
	
	</script>
	
	</p>



	<!-- third graph -->
	<p align = "center">
	<br>
	<br>
	</script>
	<h1>Average cost reduction in top 95 DRG's and the number of the DRG's with reduced costs per state </h1>
	<h3> 2011 - 2013 </h3>

	<div id="decreaseNum" align = "center"></div>
	<script type="text/javascript">
	var widthDe = 960,
    	heightDe = 500;

	var svgDe = d3.select("#decreaseNum").append("svg")
				.attr("height", heightDe).attr("width", widthDe);

	var decreaseNumScale = d3.scale.linear().domain([0, 51]).range([0,50]);
	var decreaseSumScale = d3.scale.linear().domain([-4200, 0]).range(["#0b4ccc", "#d7e4fd"]);
	var xScaleMM = d3.scale.linear().domain([-125,-65]).range([0, widthDe]);//longitude i.e. x
 	var yScaleMM = d3.scale.linear().domain([28,50]).range([heightDe, 0]);//latitude i.e. y

 	
	
	var statePathDe = svgDe.append("g");
	
	var inpatientDe;
	var alldataDe = [];


	var stateDicCircle = {}; //Created dictionary for circle sizes and color

	var names = {};
	var itemstateDicCircle;
	d3.json("us.json", function(error, shapes) {
	states = topojson.feature(shapes, shapes.objects.states).features;
	

	states.forEach(function(st){

		names[st.id] = st.id;
		//console.log(st.id);
	});

	d3.csv("inpatient.csv", function (rows) {
		
		rows.forEach(function(stateColorSize){

			if(names[stateColorSize.id])
			{
			var x = new Object();
			x["decreaseSumAverage"] = stateColorSize.decreaseNum2;
			x["decreaseSumAveragecolor"] = stateColorSize.decreaseSumAverage;
			x["nameofstate"] = stateColorSize.State;
			//arrstateObj.push(stateObj);
			stateDicCircle[stateColorSize.id] = x;
		   }
		});

	itemstateDicCircle = Object.keys(stateDicCircle).map(function(key) {
    return [key, stateDicCircle[key]];
	}); 

	itemstateDicCircle.sort(function(a,b){
		return parseInt(a[1]["decreaseSumAverage"]) - parseInt(b[1]["decreaseSumAverage"])
	});

	//itemstateDicCircle.forEach(function())

	statePathDe.selectAll("path").data(states).enter()
	.append("path")
	.attr("d", path)
	.style("fill", "white")
	.attr("opacity","1")
	.style("stroke", "white");
	
	var xCoord = {"DE" : 40, "RI" : 60, "VT" : -40, "NH" : -40, "HI":0,"CT":0};
	var yCoord = {"HI": -30, "DE": 40, "MD" : -30, "CT": 40, "VT": -40, "NH" : -40, "FL": -10};
	statePathDe.selectAll("text").data(states).enter()
	.append("svg:text")
	.attr("d", path)
	.attr("opacity","0.9")
	.style("stroke", function(d){
		if(!isNaN(path.centroid(d)[0]))
		{
			if(xCoord[stateDicCircle[d.id]["nameofstate"]] !== undefined)
			{	
      			return "white";
  			}
  			
  			return "black";
  			
 		 }
  	})
	.attr("class","statesinline")
	.text(function(d){if(stateDicCircle[d.id] !== undefined){return stateDicCircle[d.id]["nameofstate"];}})
	.attr("font-size", "10")
	.attr("x", function(d){
		if(!isNaN(path.centroid(d)[0]))
		{
			if(xCoord[stateDicCircle[d.id]["nameofstate"]] !== undefined)
			{	
      			return path.centroid(d)[0] + xCoord[stateDicCircle[d.id]["nameofstate"]];
  			}
  			
  				return path.centroid(d)[0];
  			
 		 }
  	})
  	.attr("y", function(d){
  		if(!isNaN(path.centroid(d)[1]))
		{
     
			if(yCoord[stateDicCircle[d.id]["nameofstate"]] !== undefined)
			{	
      			return path.centroid(d)[1] + yCoord[stateDicCircle[d.id]["nameofstate"]];
  			}
  			
  				return path.centroid(d)[1];
  			
  		}
  	})
  	.attr("text-anchor","middle")
    .attr('fill', 'white');


    statePathDe.selectAll("circle").data(states).enter()
	.append("svg:circle")
	.attr("d", path)
	.attr("stroke", "none")
	.attr("cx", function(d){
		if(!isNaN(path.centroid(d)[0]))
		{
      
			if(xCoord[stateDicCircle[d.id]["nameofstate"]] !== undefined)
			{	
      			return path.centroid(d)[0] + xCoord[stateDicCircle[d.id]["nameofstate"]];
  			}
  			
  				return path.centroid(d)[0];
  			
 		 
  		}
  	})
	.attr("cy", function(d){
		if(!isNaN(path.centroid(d)[1]))
		{
      
			if(yCoord[stateDicCircle[d.id]["nameofstate"]] !== undefined)
			{	
      			return path.centroid(d)[1] + yCoord[stateDicCircle[d.id]["nameofstate"]];
  			}
  			
  				return path.centroid(d)[1];
  			
 		 
  }
  	})
	.attr("r", function(d)
	{
		if(stateDicCircle[d.id] !== undefined)
		{
		//console.log(stateDicCircle[d.id]["decreaseSumAverage"]);
		var obj = stateDicCircle[d.id];
		return decreaseNumScale(obj["decreaseSumAverage"]);
	    }
	})
	.style("fill",function(d)
	{
		if(stateDicCircle[d.id] !== undefined)
		{
		//console.log(stateDicCircle[d.id]["decreaseSumAverage"]);
		var obj = stateDicCircle[d.id];
		return decreaseSumScale(obj["decreaseSumAveragecolor"]);
	    }
	} )
	.style("opacity",1);
	
	});

});
	


	var keyDe =svgDe.append("g")

	 	keyDe.append("text")
	 	.attr("x",860)
	 	.attr("y",340)
	 	.text("Key")
	 	.attr("font-size",20)
			.attr("text-anchor","middle")
			.attr("alignment-baseline","middle");
		

		var gradient3 = svg.append("defs")
  			.append("linearGradient")
		    .attr("id", "gradient1")
		    .attr("x1", "0%")
		    .attr("y1", "0%")
		    .attr("x2", "100%")
		    .attr("y2", "0%")
		    .attr("spreadMethod", "pad");

			gradient3.append("stop")
			    .attr("offset", "0%")
			    .attr("stop-color", "#0b4ccc")
			    .attr("stop-opacity", 1);

			gradient3.append("stop")
			    .attr("offset", "100%")
			    .attr("stop-color", "#d7e4fd")
			    .attr("stop-opacity", 1);


			keyDe.append("rect")
			 	.attr("x",800)
			 	.attr("y",400)
			 	.attr("width",100)
			 	.attr("height",10)
			 	.style("fill","url(#gradient1)")
			 	.style("stroke","none")	;

			 	keyDe.append("text")
	 			.attr("x",780)
	 			.attr("y",405)
	 			.text("-4000$")
	 			.attr("class","statesinline")
	 			.style("stroke","white")
	 			.attr("font-size",10)
				.attr("text-anchor","middle")
				.attr("alignment-baseline","middle");

				keyDe.append("text")
	 			.attr("x",910)
	 			.attr("y",405)
	 			.text("0$")
	 			.attr("class","statesinline" )
	 			.style("stroke","white")
	 			.attr("font-size",10)
				.attr("text-anchor","middle")
				.attr("alignment-baseline","middle");

				
				keyDe.append("text")
	 			.attr("x",850)
	 			.attr("y",435)
	 			.text("Size of the Circle : Number of DRG's")
	 			.attr("class","statesinline" )
	 			.style("stroke","white")
	 			.attr("font-size",10)
				.attr("text-anchor","middle")
				.attr("alignment-baseline","middle");

			 	keyDe.append("text")
	 			.attr("x",830)
	 			.attr("y",390)
	 			.text("average decrease amount by state")
	 			.attr("font-size",8)
				.attr("text-anchor","left")
				.attr("alignment-baseline","middle");

			


			
			
	</script>



	</p>

</body>
</html>